### Purpose

Alertmanager handles alert notifications generated by Prometheus and routes them to appropriate receivers (e.g., email, Slack, webhook). It enables deduplication, grouping, inhibition, and silencing of alerts.

---

### Overview

* Listens on port `9093`.
* Consumes alerts sent by Prometheus.
* Routes and manages alerts based on `alertmanager.yml`.
* Integrated with Grafana for centralized visibility and silencing.
* Supports receivers: Email, Slack, Webhook, PagerDuty, Opsgenie, etc.

---

### Alertmanager Configuration (Key Snippet)

```yaml
global:
  resolve_timeout: 5m

route:
  group_by: ['alertname']
  group_wait: 10s
  group_interval: 5m
  repeat_interval: 3h
  receiver: 'default-receiver'

receivers:
  - name: 'default-receiver'
    email_configs:
      - to: '<redacted-email>'
        from: '<redacted-email>'
        smarthost: '<internal-host>:587'
        auth_username: '<redacted-email>'
        auth_identity: '<redacted-email>'
        auth_password: 'USE_ENV_SECRET'
        require_tls: true
```

*Replace sensitive values with environment vars or use Vault/secrets injection.*

---

### Alertmanager Access

| Component   | Value                                  |
| ----------- | -------------------------------------- |
| UI URL      | `https://internal.example` |
| Config file | `/etc/alertmanager/alertmanager.yml`   |
| Systemd svc | `alertmanager.service`                 |
| Logs        | `journalctl -u alertmanager`           |

---

### Integration with Prometheus

Prometheus `prometheus.yml` config snippet to link Alertmanager:

```yaml
alerting:
  alertmanagers:
    - static_configs:
        - targets:
          - 'localhost:9093'
```

*Ensure Prometheus can reach Alertmanager on port `9093`.*

---

### Alertmanager Rules (in Prometheus)

Prometheus `rules.yml` example:

```yaml
groups:
  - name: system-rules
    rules:
      - alert: InstanceDown
        expr: up == 0
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "Instance {{ $labels.instance }} down"
          description: "{{ $labels.instance }} of job {{ $labels.job }} has been down for more than 2 minutes."
```

Include this in `prometheus.yml`:

```yaml
rule_files:
  - /etc/prometheus/rules.yml
```

---

### Silences and Alert History

Use the Alertmanager web UI to:

* Silence specific alerts or patterns (use regex, duration, labels).
* View active, pending, and suppressed alerts.
* Review alert status and delivery logs.

---

### Usage Notes

* Grouping prevents spam from similar alerts (e.g., multiple nodes failing).
* `repeat_interval` controls how often a repeated alert is sent.
* TLS, auth, and mail secrets should not be stored plaintext in production environments.
* Consider reverse proxy + internal TLS via your private CA (`<internal-host>`).

---

## Workflow Summary

| Step                       | Description                                                      |
| -------------------------- | ---------------------------------------------------------------- |
| 1. Prometheus sends alerts | Matches `expr:` rules defined in `rules.yml`                     |
| 2. Alertmanager receives   | Listens on port 9093, matches `alertmanager.yml` routing rules   |
| 3. Alerts routed/deduped   | Routed to appropriate receivers with grouping + inhibition logic |
| 4. Notifications sent      | Email, webhook, or other receiver is notified of the alert       |
| 5. Grafana UI integration  | View/silence alerts from within Grafana interface                |

---
